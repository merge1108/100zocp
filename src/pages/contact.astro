---
import BaseLayout from "../layouts/BaseLayout.astro";
const PHONE = "1811-6828";
const FORM_ENDPOINT = "https://hook.us2.make.com/qbn90ednknikg7cgy9k8mrem9tgp66a3";
---
<BaseLayout title="상담문의 | 백조마케팅" desc="프로젝트 상담 신청">
  <main id="main">
    <section class="section">
      <div class="container">
        <h1 class="h2">상담문의</h1>

        <div class="meta" style="margin:var(--space-3) 0">
          <p><strong>전화:</strong> <a class="btn" href={"tel:"+PHONE}>{PHONE} 바로 전화</a></p>
        </div>

        <div class="meta">
          <form method="post" action={FORM_ENDPOINT}>
            <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center">
              <input type="tel" name="phone" required inputmode="tel"
                     placeholder="예) 01012345678"
                     pattern="^(\\+?\\d{7,15})$|^0\\d{8,10}$"
                     style="flex:1; min-width:220px; padding:12px 14px; border:1px solid var(--border); border-radius:10px" />
              <input type="hidden" name="route" value="contact" />
              <!-- 계산기 파라미터 전달용 -->
              <input type="hidden" name="budget" id="f_budget" />
              <input type="hidden" name="cpl" id="f_cpl" />
              <input type="hidden" name="channels" id="f_channels" />
              <input type="hidden" name="pkg" id="f_pkg" />
              <button class="btn" type="submit">무료 상담 신청</button>
            </div>
            <small class="muted">* 접수 후 담당자가 문자 드립니다. (내용 확인 후 연락)</small>
          </form>
        </div>

        <div class="panel-dark" style="margin-top:var(--space-3)">
          <h3 style="margin:0 0 8px">요청 요약</h3>
          <div style="display:flex; gap:16px; flex-wrap:wrap">
            <div><strong>월 매체비:</strong> <span id="s_budget">-</span></div>
            <div><strong>목표 CPL:</strong> <span id="s_cpl">-</span></div>
            <div><strong>예상 리드:</strong> <span id="s_leads">-</span></div>
            <div><strong>권장 패키지:</strong> <span id="s_pkg">-</span></div>
            <div><strong>채널:</strong> <span id="s_channels">-</span></div>
          </div>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<script is:inline>
  const qp = new URLSearchParams(location.search);
  const budget = Number(qp.get('budget')) || null; // 만원
  const cpl = Number(qp.get('cpl')) || null;       // 만원
  const channels = (qp.get('channels')||'').split(',').filter(Boolean);
  const pkg = qp.get('pkg') || null;
  const leads = budget && cpl ? Math.floor(budget / cpl) : null;

  const set = (id, v)=>{ const el = document.getElementById(id); if(el) el.textContent = v ?? '-'; };
  set('s_budget', budget? budget.toLocaleString('ko-KR')+' 만원' : '-');
  set('s_cpl', cpl? cpl+' 만원' : '-');
  set('s_leads', leads? leads.toLocaleString('ko-KR')+' 건' : '-');
  set('s_pkg', pkg??'-');
  set('s_channels', channels.length? channels.join(', ') : '-');
  const hv = (id, v)=>{ const el=document.getElementById(id); if(el) el.value = v??''; };
  hv('f_budget', budget??''); hv('f_cpl', cpl??''); hv('f_channels', channels.join(',') ); hv('f_pkg', pkg??'');
</script>

